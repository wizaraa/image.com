<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #45a049;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: left;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-box">
        <h1>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h1>
        <p>Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Google Sheets</p>
        
        <div>
            <label for="scriptUrl">Ø±Ø§Ø¨Ø· Google Apps Script:</label><br>
            <input type="text" id="scriptUrl" style="width: 100%; padding: 10px; margin: 10px 0;" 
                   value="https://script.google.com/macros/s/AKfycbyAnQqHdzYjEfZdW4DJbSen8H6dz2nLJuWZVwx6TzfoE4nfa2fxRDxb6xP8BxW2uPnS/exec">
        </div>
        
        <button onclick="testConnection()">ğŸš€ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
        <button onclick="sendRealData()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©</button>
        <button onclick="clearLog()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
        
        <div id="status" class="status"></div>
        <div id="log" class="log"></div>
    </div>

    <script>
        let logContent = '';

        function log(message) {
            const timestamp = new Date().toLocaleTimeString('ar-IQ');
            logContent += `[${timestamp}] ${message}\n`;
            document.getElementById('log').textContent = logContent;
            console.log(message);
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = isError ? 'status error' : 'status success';
            statusDiv.style.display = 'block';
        }

        function clearLog() {
            logContent = '';
            document.getElementById('log').textContent = '';
            document.getElementById('status').style.display = 'none';
        }

        async function testConnection() {
            const scriptUrl = document.getElementById('scriptUrl').value.trim();
            
            if (!scriptUrl) {
                showStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Google Apps Script', true);
                return;
            }

            log('ğŸ” Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...');
            log('ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·: ' + scriptUrl);

            try {
                // Ø§Ø®ØªØ¨Ø§Ø± GET Ø£ÙˆÙ„Ø§Ù‹
                log('ğŸ“¡ Ø§Ø®ØªØ¨Ø§Ø± GET request...');
                const getResponse = await fetch(scriptUrl, { method: 'GET' });
                const getResult = await getResponse.text();
                log('âœ… GET response: ' + getResult);

                // Ø§Ø®ØªØ¨Ø§Ø± POST
                log('ğŸ“¤ Ø§Ø®ØªØ¨Ø§Ø± POST request...');
                const testData = {
                    test: true,
                    timestamp: new Date().toLocaleString('ar-IQ'),
                    page_url: 'ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±',
                    user_agent: navigator.userAgent,
                    test_id: 'DIRECT_TEST_' + Date.now()
                };

                log('ğŸ“¦ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©: ' + JSON.stringify(testData, null, 2));

                const formData = 'data=' + encodeURIComponent(JSON.stringify(testData));
                log('ğŸ“ Form data length: ' + formData.length + ' characters');

                const postResponse = await fetch(scriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                log('ğŸ“¬ POST status: ' + postResponse.status);
                
                try {
                    const postResult = await postResponse.text();
                    log('âœ… POST response: ' + postResult);
                } catch (e) {
                    log('âš ï¸ Could not read POST response (this is normal with no-cors)');
                }

                showStatus('âœ… ØªÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­! ØªØ­Ù‚Ù‚ Ù…Ù† Google Sheet');

            } catch (error) {
                log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ' + error.message);
                showStatus('âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ' + error.message, true);
            }
        }

        async function sendRealData() {
            const scriptUrl = document.getElementById('scriptUrl').value.trim();
            
            if (!scriptUrl) {
                showStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Google Apps Script', true);
                return;
            }

            log('ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©...');

            // Ø¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©
            const data = {
                timestamp: new Date().toLocaleString('ar-IQ'),
                page_url: window.location.href,
                referrer: document.referrer || 'Ù…Ø¨Ø§Ø´Ø±',
                device_type: /Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'Ù…ÙˆØ¨Ø§ÙŠÙ„' : 'ÙƒÙ…Ø¨ÙŠÙˆØªØ±',
                browser: getBrowser(),
                operating_system: getOS(),
                screen_resolution: screen.width + 'x' + screen.height,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                language: navigator.language,
                user_agent: navigator.userAgent,
                test_id: 'REAL_DATA_' + Date.now()
            };

            log('ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©: ' + JSON.stringify(data, null, 2));

            try {
                const formData = 'data=' + encodeURIComponent(JSON.stringify(data));
                
                const response = await fetch(scriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©');
                showStatus('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©! ØªØ­Ù‚Ù‚ Ù…Ù† Google Sheet');

                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ø¨Ù€ GET
                setTimeout(async () => {
                    try {
                        const getUrl = scriptUrl + '?data=' + encodeURIComponent(JSON.stringify(data));
                        await fetch(getUrl, { method: 'GET' });
                        log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù€ GET');
                    } catch (e) {
                        log('âš ï¸ ÙØ´Ù„Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ' + e.message);
                    }
                }, 1000);

            } catch (error) {
                log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
                showStatus('âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + error.message, true);
            }
        }

        function getBrowser() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'ÙƒØ±ÙˆÙ…';
            if (ua.includes('Firefox')) return 'ÙØ§ÙŠØ±ÙÙˆÙƒØ³';
            if (ua.includes('Safari')) return 'Ø³ÙØ§Ø±ÙŠ';
            if (ua.includes('Edge')) return 'Ø¥ÙŠØ¯Ø¬';
            return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        }

        function getOS() {
            const ua = navigator.userAgent;
            if (ua.includes('Windows')) return 'ÙˆÙŠÙ†Ø¯ÙˆØ²';
            if (ua.includes('Mac')) return 'Ù…Ø§Ùƒ';
            if (ua.includes('Linux')) return 'Ù„ÙŠÙ†ÙƒØ³';
            if (ua.includes('Android')) return 'Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯';
            if (ua.includes('iOS')) return 'iOS';
            return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', function() {
            log('ğŸ ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
            log('ğŸŒ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ: ' + window.location.href);
            log('ğŸ“± Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²: ' + (/Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'Ù…ÙˆØ¨Ø§ÙŠÙ„' : 'ÙƒÙ…Ø¨ÙŠÙˆØªØ±'));
            log('ğŸ”§ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±!');
        });
    </script>
</body>
</html>
